import{r as n,j as e,H as Q}from"./app-DRtgPiAO.js";import{a as j}from"./app-Da9Q4cYH.js";function b(c){if(!c)return"-";try{return new Intl.DateTimeFormat("nl-NL",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(c))}catch{return String(c)}}function g(c){return c?String(c).replace(/_/g," "):""}function W({name:c}){const i=String(c||"").trim().split(" ").filter(Boolean).map(l=>l.slice(0,1)).join("").slice(0,2).toUpperCase();return e.jsx("span",{className:"rounded-full bg-zinc-100 px-2 py-0.5 text-xs font-semibold",children:i||"--"})}function fe({initial:c,filters:i,urls:l}){var L;const[d,z]=n.useState((c==null?void 0:c.tasks)??[]),[X,M]=n.useState((c==null?void 0:c.projects)??[]),[v,U]=n.useState((c==null?void 0:c.users)??[]),[h,H]=n.useState((c==null?void 0:c.statusOptions)??[]),[Y,V]=n.useState((c==null?void 0:c.priorityOptions)??[]),[o,N]=n.useState("board"),[S,Z]=n.useState((i==null?void 0:i.project)??""),[w,ee]=n.useState((i==null?void 0:i.assignee)??""),[k,se]=n.useState((i==null?void 0:i.status)??""),[T,te]=n.useState((i==null?void 0:i.priority)??""),[C,ne]=n.useState((i==null?void 0:i.search)??""),[ae,D]=n.useState(!1),[ce,ie]=n.useState({naam:"",omschrijving:"",deadline:"",kleur:""}),[re,de]=n.useState({}),[le,oe]=n.useState(!1),[me,xe]=n.useState({titel:"",omschrijving:"",task_project_id:"",status:"open",prioriteit:"normaal",deadline:"",labels:"",assignees:[]}),[he,ue]=n.useState([]),[pe,je]=n.useState({}),[be,ge]=n.useState(!1),[P,E]=n.useState(null),[r,x]=n.useState(null),[f,F]=n.useState(""),[O,G]=n.useState(!1),[y,m]=n.useState(null),_=n.useCallback(async()=>{D(!0);try{const s=await j.get("/taken/data",{params:{project:S||void 0,assignee:w||void 0,status:k||void 0,priority:T||void 0,search:C||void 0}});z(s.data.tasks??[]),M(s.data.projects??[]),U(s.data.users??[]),H(s.data.statusOptions??[]),V(s.data.priorityOptions??[])}catch{m({tone:"error",text:"Taken laden mislukt. Probeer opnieuw."})}finally{D(!1)}},[S,w,k,T,C]);n.useEffect(()=>{const s=setTimeout(()=>{_()},250);return()=>clearTimeout(s)},[_]);const B=n.useMemo(()=>{const s={};return h.forEach(t=>{s[t]=[]}),d.forEach(t=>{s[t.status]||(s[t.status]=[]),s[t.status].push(t)}),s},[d,h]),$=n.useMemo(()=>{const s={};return v.forEach(t=>{s[t.id]=[]}),d.forEach(t=>{!t.assignees||t.assignees.length===0||t.assignees.forEach(a=>{s[a.id]||(s[a.id]=[]),s[a.id].push(t)})}),s},[d,v]),A=n.useMemo(()=>d.filter(s=>!s.assignees||s.assignees.length===0),[d]),q=n.useCallback(s=>{z(t=>t.map(a=>a.id===s.id?{...a,...s}:a)),x(t=>t&&t.id===s.id?{...t,...s}:t)},[]),I=async(s,t)=>{try{const a=await j.patch(`/taken/tasks/${s}/status`,{status:t});q(a.data.task)}catch{m({tone:"error",text:"Status bijwerken mislukt."})}},u=async s=>{E(s),x(null);try{const t=await j.get(`/taken/${s}`);x(t.data.task)}catch{m({tone:"error",text:"Taakdetails laden mislukt."})}},J=async s=>{if(s.preventDefault(),!(!P||!f.trim())){G(!0);try{const t=await j.post(`/taken/tasks/${P}/comments`,{body:f});x(a=>a&&{...a,comments:[...a.comments??[],t.data.comment]}),F(""),m({tone:"success",text:"Reactie geplaatst."})}catch{m({tone:"error",text:"Reactie plaatsen mislukt."})}finally{G(!1)}}},K=async(s,t)=>{var p;s.preventDefault();const a=(p=s.dataTransfer)==null?void 0:p.getData("text/task-id");!a||!t||await I(a,t)};return e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:"Taken"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Taken"}),e.jsx("div",{className:"mt-1 text-sm text-zinc-600",children:"Overzicht per taak, project en team."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>N("list"),className:`rounded-md border px-3 py-1.5 text-sm font-semibold ${o==="list"?"border-zinc-900 bg-zinc-900 text-white":"border-zinc-200 hover:bg-zinc-50"}`,children:"Lijst"}),e.jsx("button",{type:"button",onClick:()=>N("board"),className:`rounded-md border px-3 py-1.5 text-sm font-semibold ${o==="board"?"border-zinc-900 bg-zinc-900 text-white":"border-zinc-200 hover:bg-zinc-50"}`,children:"Board"}),e.jsx("button",{type:"button",onClick:()=>N("team"),className:`rounded-md border px-3 py-1.5 text-sm font-semibold ${o==="team"?"border-zinc-900 bg-zinc-900 text-white":"border-zinc-200 hover:bg-zinc-50"}`,children:"Team"}),l!=null&&l.tasks_old?e.jsx("a",{href:l.tasks_old,className:"rounded-md border border-zinc-200 px-3 py-1.5 text-sm font-semibold text-zinc-500 hover:bg-zinc-50",children:"Taken (old)"}):null]})]}),y?e.jsx("div",{className:`rounded-lg border px-4 py-3 text-sm ${y.tone==="success"?"border-emerald-200 bg-emerald-50 text-emerald-800":"border-rose-200 bg-rose-50 text-rose-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{children:y.text}),e.jsx("button",{type:"button",className:"text-xs font-semibold",onClick:()=>m(null),children:"Sluiten"})]})}):null,o==="list"?e.jsxs("div",{className:"rounded-xl border border-zinc-200 bg-white",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 border-b border-zinc-100 px-4 py-3 text-xs font-semibold text-zinc-500",children:[e.jsx("div",{className:"col-span-4",children:"Taak"}),e.jsx("div",{className:"col-span-2",children:"Project"}),e.jsx("div",{className:"col-span-2",children:"Assignees"}),e.jsx("div",{className:"col-span-2",children:"Status"}),e.jsx("div",{className:"col-span-2",children:"Deadline"})]}),e.jsx("div",{className:"divide-y divide-zinc-100",children:d.length===0?e.jsx("div",{className:"px-4 py-6 text-sm text-zinc-500",children:"Geen taken gevonden."}):d.map(s=>{var t;return e.jsxs("div",{className:"grid grid-cols-12 gap-2 px-4 py-3 text-sm hover:bg-zinc-50",children:[e.jsxs("div",{className:"col-span-4",children:[e.jsx("button",{type:"button",onClick:()=>u(s.id),className:"text-left font-semibold text-zinc-900 hover:text-zinc-700",children:s.titel}),s.labels?e.jsx("div",{className:"mt-1 text-xs text-zinc-500",children:s.labels}):null]}),e.jsx("div",{className:"col-span-2 text-sm text-zinc-600",children:((t=s.project)==null?void 0:t.naam)??"-"}),e.jsx("div",{className:"col-span-2 flex flex-wrap gap-1",children:s.assignees&&s.assignees.length>0?s.assignees.map(a=>e.jsx(W,{name:a.name},a.id)):e.jsx("span",{className:"text-xs text-zinc-400",children:"--"})}),e.jsx("div",{className:"col-span-2",children:e.jsx("select",{className:"w-full rounded-md border-zinc-200 text-xs",value:s.status,onChange:a=>I(s.id,a.target.value),children:h.map(a=>e.jsx("option",{value:a,children:g(a)},a))})}),e.jsx("div",{className:"col-span-2 text-xs text-zinc-500",children:s.deadline?b(s.deadline):"Geen"})]},s.id)})})]}):null,o==="board"?e.jsx("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-4",children:h.map(s=>e.jsxs("div",{className:"rounded-xl border border-zinc-200 bg-white p-4",onDragOver:t=>t.preventDefault(),onDrop:t=>K(t,s),children:[e.jsx("div",{className:"text-sm font-semibold",children:g(s)}),e.jsxs("div",{className:"mt-3 space-y-3",children:[(B[s]??[]).map(t=>{var a;return e.jsxs("div",{className:"cursor-move rounded-lg border border-zinc-200 bg-zinc-50 p-3",draggable:!0,onDragStart:p=>{var R;return(R=p.dataTransfer)==null?void 0:R.setData("text/task-id",String(t.id))},onClick:()=>u(t.id),children:[e.jsx("div",{className:"text-sm font-semibold",children:t.titel}),e.jsx("div",{className:"mt-1 text-xs text-zinc-500",children:((a=t.project)==null?void 0:a.naam)??"Geen project"}),t.deadline?e.jsxs("div",{className:"mt-2 text-xs text-zinc-500",children:["Deadline: ",b(t.deadline)]}):null]},t.id)}),(B[s]??[]).length===0?e.jsx("div",{className:"text-xs text-zinc-400",children:"Geen taken."}):null]})]},s))}):null,o==="team"?e.jsxs("div",{className:"space-y-4",children:[v.map(s=>e.jsxs("div",{className:"rounded-xl border border-zinc-200 bg-white p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name}),e.jsx("div",{className:"mt-3 space-y-2",children:($[s.id]??[]).length===0?e.jsx("div",{className:"text-xs text-zinc-400",children:"Geen taken."}):($[s.id]??[]).map(t=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("button",{type:"button",onClick:()=>u(t.id),className:"text-left hover:text-zinc-700",children:t.titel}),e.jsx("span",{className:"text-xs text-zinc-500",children:g(t.status)})]},t.id))})]},s.id)),e.jsxs("div",{className:"rounded-xl border border-zinc-200 bg-white p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Niet toegewezen"}),e.jsx("div",{className:"mt-3 space-y-2",children:A.length===0?e.jsx("div",{className:"text-xs text-zinc-400",children:"Geen taken."}):A.map(s=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("button",{type:"button",onClick:()=>u(s.id),className:"text-left hover:text-zinc-700",children:s.titel}),e.jsx("span",{className:"text-xs text-zinc-500",children:g(s.status)})]},s.id))})]})]}):null,r?e.jsxs("div",{className:"rounded-xl border border-zinc-200 bg-white p-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:r.titel}),e.jsx("div",{className:"text-xs text-zinc-500",children:((L=r.project)==null?void 0:L.naam)??"Geen project"})]}),e.jsx("button",{type:"button",className:"text-xs text-zinc-500 hover:text-zinc-700",onClick:()=>{E(null),x(null)},children:"Sluiten"})]}),r.omschrijving?e.jsx("div",{className:"mt-3 text-sm text-zinc-700",children:r.omschrijving}):null,e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 lg:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-500",children:"Assignees"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:r.assignees&&r.assignees.length>0?r.assignees.map(s=>e.jsx("span",{className:"rounded-full bg-zinc-100 px-2 py-0.5 text-xs font-semibold",children:s.name},s.id)):e.jsx("span",{className:"text-xs text-zinc-400",children:"Geen"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-500",children:"Deadline"}),e.jsx("div",{className:"mt-2 text-sm",children:r.deadline?b(r.deadline):"Geen"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-500",children:"Prioriteit"}),e.jsx("div",{className:"mt-2 text-sm",children:r.prioriteit})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Reacties"}),e.jsx("ul",{className:"mt-3 space-y-3",children:r.comments&&r.comments.length>0?r.comments.map(s=>{var t;return e.jsxs("li",{className:"rounded-lg border border-zinc-200 p-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-zinc-500",children:[((t=s.author)==null?void 0:t.name)??"Onbekend"," - ",b(s.created_at)]}),e.jsx("div",{className:"mt-2 text-sm text-zinc-700",children:s.body})]},s.id)}):e.jsx("li",{className:"text-xs text-zinc-400",children:"Nog geen reacties."})}),e.jsxs("form",{className:"mt-4 space-y-2",onSubmit:J,children:[e.jsx("textarea",{className:"w-full rounded-md border-zinc-300 text-sm",rows:"3",value:f,onChange:s=>F(s.target.value),placeholder:"Schrijf een reactie en tag met @naam"}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",className:"rounded-md bg-zinc-900 px-3 py-2 text-xs font-semibold text-white",disabled:O,children:O?"Plaatsen...":"Plaatsen"})})]})]}),r.attachments&&r.attachments.length>0?e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Bijlagen"}),e.jsx("ul",{className:"mt-3 space-y-2 text-sm",children:r.attachments.map(s=>e.jsxs("li",{className:"flex items-center justify-between rounded-md border border-zinc-200 px-3 py-2",children:[e.jsx("span",{className:"truncate",children:s.original_name}),e.jsx("a",{className:"text-xs font-semibold text-indigo-700 hover:text-indigo-900",href:s.url,target:"_blank",rel:"noopener",children:"Open"})]},s.id))})]}):null]}):null]})]})}export{fe as default};
