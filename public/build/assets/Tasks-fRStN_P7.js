import{r as n,j as e,H as Q}from"./app-TP49IIGm.js";import{a as h}from"./app-Da9Q4cYH.js";function f(a){if(!a)return"-";try{return new Intl.DateTimeFormat("nl-NL",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(a))}catch{return String(a)}}function y(a){return a?String(a).replace(/_/g," "):""}function Ne({initial:a,filters:d,urls:x}){var I;const[i,z]=n.useState((a==null?void 0:a.tasks)??[]),[W,R]=n.useState((a==null?void 0:a.projects)??[]),[p,M]=n.useState((a==null?void 0:a.users)??[]),[j,H]=n.useState((a==null?void 0:a.statusOptions)??[]),[X,U]=n.useState((a==null?void 0:a.priorityOptions)??[]),[l,b]=n.useState("list"),[S,Y]=n.useState((d==null?void 0:d.project)??""),[k,Z]=n.useState((d==null?void 0:d.assignee)??""),[w,ee]=n.useState((d==null?void 0:d.status)??""),[T,te]=n.useState((d==null?void 0:d.priority)??""),[C,se]=n.useState((d==null?void 0:d.search)??""),[ne,D]=n.useState(!1),[ae,ce]=n.useState({naam:"",omschrijving:"",deadline:"",kleur:""}),[re,de]=n.useState({}),[ie,oe]=n.useState(!1),[le,me]=n.useState({titel:"",omschrijving:"",task_project_id:"",status:"open",prioriteit:"normaal",deadline:"",labels:"",assignees:[]}),[xe,ue]=n.useState([]),[he,pe]=n.useState({}),[je,be]=n.useState(!1),[P,E]=n.useState(null),[r,m]=n.useState(null),[g,F]=n.useState(""),[O,_]=n.useState(!1),[v,o]=n.useState(null),G=n.useCallback(async()=>{D(!0);try{const t=await h.get("/taken/data",{params:{project:S||void 0,assignee:k||void 0,status:w||void 0,priority:T||void 0,search:C||void 0}});z(t.data.tasks??[]),R(t.data.projects??[]),M(t.data.users??[]),H(t.data.statusOptions??[]),U(t.data.priorityOptions??[])}catch{o({tone:"error",text:"Taken laden mislukt. Probeer opnieuw."})}finally{D(!1)}},[S,k,w,T,C]);n.useEffect(()=>{const t=setTimeout(()=>{G()},250);return()=>clearTimeout(t)},[G]);const $=n.useMemo(()=>{const t={};return j.forEach(s=>{t[s]=[]}),i.forEach(s=>{t[s.status]||(t[s.status]=[]),t[s.status].push(s)}),t},[i,j]),B=n.useMemo(()=>{const t={};return p.forEach(s=>{t[s.id]=[]}),i.forEach(s=>{!s.assignees||s.assignees.length===0||s.assignees.forEach(c=>{t[c.id]||(t[c.id]=[]),t[c.id].push(s)})}),t},[i,p]),A=n.useMemo(()=>i.filter(t=>!t.assignees||t.assignees.length===0),[i]),V=n.useCallback(t=>{z(s=>s.map(c=>c.id===t.id?{...c,...t}:c)),m(s=>s&&s.id===t.id?{...s,...t}:s)},[]),q=async(t,s)=>{try{const c=await h.patch(`/taken/tasks/${t}/status`,{status:s});V(c.data.task)}catch{o({tone:"error",text:"Status bijwerken mislukt."})}},N=async t=>{E(t),m(null);try{const s=await h.get(`/taken/${t}`);m(s.data.task)}catch{o({tone:"error",text:"Taakdetails laden mislukt."})}},J=async t=>{if(t.preventDefault(),!(!P||!g.trim())){_(!0);try{const s=await h.post(`/taken/tasks/${P}/comments`,{body:g});m(c=>c&&{...c,comments:[...c.comments??[],s.data.comment]}),F(""),o({tone:"success",text:"Reactie geplaatst."})}catch{o({tone:"error",text:"Reactie plaatsen mislukt."})}finally{_(!1)}}},K=async(t,s)=>{var u;t.preventDefault();const c=(u=t.dataTransfer)==null?void 0:u.getData("text/task-id");!c||!s||await q(c,s)};return e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:"Taken"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Taken"}),e.jsx("div",{className:"mt-1 text-sm text-zinc-600",children:"Overzicht per taak, project en team."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>b("list"),className:`rounded-md border px-3 py-1.5 text-sm font-semibold ${l==="list"?"border-zinc-900 bg-zinc-900 text-white":"border-zinc-200 hover:bg-zinc-50"}`,children:"Lijst"}),e.jsx("button",{type:"button",onClick:()=>b("board"),className:`rounded-md border px-3 py-1.5 text-sm font-semibold ${l==="board"?"border-zinc-900 bg-zinc-900 text-white":"border-zinc-200 hover:bg-zinc-50"}`,children:"Board"}),e.jsx("button",{type:"button",onClick:()=>b("team"),className:`rounded-md border px-3 py-1.5 text-sm font-semibold ${l==="team"?"border-zinc-900 bg-zinc-900 text-white":"border-zinc-200 hover:bg-zinc-50"}`,children:"Team"}),x!=null&&x.tasks_old?e.jsx("a",{href:x.tasks_old,className:"rounded-md border border-zinc-200 px-3 py-1.5 text-sm font-semibold text-zinc-500 hover:bg-zinc-50",children:"Taken (old)"}):null]})]}),v?e.jsx("div",{className:`rounded-lg border px-4 py-3 text-sm ${v.tone==="success"?"border-emerald-200 bg-emerald-50 text-emerald-800":"border-rose-200 bg-rose-50 text-rose-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{children:v.text}),e.jsx("button",{type:"button",className:"text-xs font-semibold",onClick:()=>o(null),children:"Sluiten"})]})}):null,l==="board"?e.jsx("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-4",children:j.map(t=>e.jsxs("div",{className:"rounded-xl border border-zinc-200 bg-white p-4",onDragOver:s=>s.preventDefault(),onDrop:s=>K(s,t),children:[e.jsx("div",{className:"text-sm font-semibold",children:y(t)}),e.jsxs("div",{className:"mt-3 space-y-3",children:[($[t]??[]).map(s=>{var c;return e.jsxs("div",{className:"cursor-move rounded-lg border border-zinc-200 bg-zinc-50 p-3",draggable:!0,onDragStart:u=>{var L;return(L=u.dataTransfer)==null?void 0:L.setData("text/task-id",String(s.id))},onClick:()=>N(s.id),children:[e.jsx("div",{className:"text-sm font-semibold",children:s.titel}),e.jsx("div",{className:"mt-1 text-xs text-zinc-500",children:((c=s.project)==null?void 0:c.naam)??"Geen project"}),s.deadline?e.jsxs("div",{className:"mt-2 text-xs text-zinc-500",children:["Deadline: ",f(s.deadline)]}):null]},s.id)}),($[t]??[]).length===0?e.jsx("div",{className:"text-xs text-zinc-400",children:"Geen taken."}):null]})]},t))}):null,l==="team"?e.jsxs("div",{className:"space-y-4",children:[p.map(t=>e.jsxs("div",{className:"rounded-xl border border-zinc-200 bg-white p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:t.name}),e.jsx("div",{className:"mt-3 space-y-2",children:(B[t.id]??[]).length===0?e.jsx("div",{className:"text-xs text-zinc-400",children:"Geen taken."}):(B[t.id]??[]).map(s=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("button",{type:"button",onClick:()=>N(s.id),className:"text-left hover:text-zinc-700",children:s.titel}),e.jsx("span",{className:"text-xs text-zinc-500",children:y(s.status)})]},s.id))})]},t.id)),e.jsxs("div",{className:"rounded-xl border border-zinc-200 bg-white p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Niet toegewezen"}),e.jsx("div",{className:"mt-3 space-y-2",children:A.length===0?e.jsx("div",{className:"text-xs text-zinc-400",children:"Geen taken."}):A.map(t=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("button",{type:"button",onClick:()=>N(t.id),className:"text-left hover:text-zinc-700",children:t.titel}),e.jsx("span",{className:"text-xs text-zinc-500",children:y(t.status)})]},t.id))})]})]}):null,r?e.jsxs("div",{className:"rounded-xl border border-zinc-200 bg-white p-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:r.titel}),e.jsx("div",{className:"text-xs text-zinc-500",children:((I=r.project)==null?void 0:I.naam)??"Geen project"})]}),e.jsx("button",{type:"button",className:"text-xs text-zinc-500 hover:text-zinc-700",onClick:()=>{E(null),m(null)},children:"Sluiten"})]}),r.omschrijving?e.jsx("div",{className:"mt-3 text-sm text-zinc-700",children:r.omschrijving}):null,e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 lg:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-500",children:"Assignees"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:r.assignees&&r.assignees.length>0?r.assignees.map(t=>e.jsx("span",{className:"rounded-full bg-zinc-100 px-2 py-0.5 text-xs font-semibold",children:t.name},t.id)):e.jsx("span",{className:"text-xs text-zinc-400",children:"Geen"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-500",children:"Deadline"}),e.jsx("div",{className:"mt-2 text-sm",children:r.deadline?f(r.deadline):"Geen"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-500",children:"Prioriteit"}),e.jsx("div",{className:"mt-2 text-sm",children:r.prioriteit})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Reacties"}),e.jsx("ul",{className:"mt-3 space-y-3",children:r.comments&&r.comments.length>0?r.comments.map(t=>{var s;return e.jsxs("li",{className:"rounded-lg border border-zinc-200 p-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-zinc-500",children:[((s=t.author)==null?void 0:s.name)??"Onbekend"," - ",f(t.created_at)]}),e.jsx("div",{className:"mt-2 text-sm text-zinc-700",children:t.body})]},t.id)}):e.jsx("li",{className:"text-xs text-zinc-400",children:"Nog geen reacties."})}),e.jsxs("form",{className:"mt-4 space-y-2",onSubmit:J,children:[e.jsx("textarea",{className:"w-full rounded-md border-zinc-300 text-sm",rows:"3",value:g,onChange:t=>F(t.target.value),placeholder:"Schrijf een reactie en tag met @naam"}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",className:"rounded-md bg-zinc-900 px-3 py-2 text-xs font-semibold text-white",disabled:O,children:O?"Plaatsen...":"Plaatsen"})})]})]}),r.attachments&&r.attachments.length>0?e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Bijlagen"}),e.jsx("ul",{className:"mt-3 space-y-2 text-sm",children:r.attachments.map(t=>e.jsxs("li",{className:"flex items-center justify-between rounded-md border border-zinc-200 px-3 py-2",children:[e.jsx("span",{className:"truncate",children:t.original_name}),e.jsx("a",{className:"text-xs font-semibold text-indigo-700 hover:text-indigo-900",href:t.url,target:"_blank",rel:"noopener",children:"Open"})]},t.id))})]}):null]}):null]})]})}export{Ne as default};
